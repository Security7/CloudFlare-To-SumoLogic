"LambdaCloudFlareToSumoLogic": {
    "Type" : "AWS::Lambda::Function",
    "DependsOn": ["RoleCloudFlareToSumoLogic"],
    "Properties" : {
        "Description" : "This function will get logs from CloudFlare, process them and pass them to Sumo Logic",
        "FunctionName" : {"Fn::Join": ["", ["-", "CloudFlare-To-SumoLogic", { "Ref": "AWS::StackName" }]]},
        "Code" : {
            "S3Bucket": { "Ref": "BucketName"},
            "S3Key": "CloudFlare-To-SumoLogic.zip"
        },
        "Environment" : {
            "Variables": {
                "CLOUDFLARE_AUTH_EMAIL": { "Ref": "CLOUDFLARE_AUTH_EMAIL"},
                "CLOUDFLARE_AUTH_KEY": { "Ref": "CLOUDFLARE_AUTH_KEY"},
                "CLOUDFLARE_FIELDS": { "Ref": "CLOUDFLARE_FIELDS"},
                "CLOUDFLARE_ZONE_ID": { "Ref": "CLOUDFLARE_ZONE_ID"},
                "SOURCE_CATEGORY_OVERRIDE": { "Ref": "SOURCE_CATEGORY_OVERRIDE"},
                "SOURCE_HOST_OVERRIDE": { "Ref": "SOURCE_HOST_OVERRIDE"},
                "SOURCE_NAME_OVERRIDE": { "Ref": "SOURCE_NAME_OVERRIDE"},
                "SUMO_ENDPOINT": { "Ref": "SUMO_ENDPOINT"}
            }
        },
        "Handler" : "index.handler",
        "MemorySize" : 512,
        "Role" : {"Fn::GetAtt" : ["RoleCloudFlareToSumoLogic", "Arn"] },
        "Runtime" : "nodejs8.10",
        "Timeout" : 60
    }
},

"RoleCloudFlareToSumoLogic": {
    "Type": "AWS::IAM::Role",
    "Properties": {
        "RoleName": {"Fn::Join": ["", ["CloudFlare-To-SumoLogic", "-", { "Ref": "AWS::StackName"}]]},
        "AssumeRolePolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Effect": "Allow",
                    "Principal": {
                        "Service": "lambda.amazonaws.com"
                    },
                    "Action": "sts:AssumeRole"
                }
            ]
        },
        "ManagedPolicyArns": [
            "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
        ]
    }
},